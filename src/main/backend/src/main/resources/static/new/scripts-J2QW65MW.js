let page=0;async function loadMore(){console.log("Load more function called");const e=document.getElementById("loadMore").getAttribute("data-page")||0,r=parseInt(e)+1;console.log("Loading page:",r),fetch(`/?page=${r}`,{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(t=>(console.log("Response status:",t.status),t.json())).then(t=>{if(console.log("Received data:",t),t.activities&&t.activities.length>0){console.log("Activities found:",t.activities.length);const n=document.getElementById("allActivitiesPaginated");t.activities.forEach(o=>{console.log("Adding activity:",o.id,o.name);const a=`
                <div class="col-sm-12 col-lg-3">
                    <div class="product-item bg-light">
                        <div class="card">
                            <div class="thumb-content">
                                <a href="/activity/${o.id}">
                                    <img class="card-img-top img-fluid" src="/activity/${o.id}/image" alt="Card image cap">
                                </a>
                            </div>
                            <div class="card-body">
                                <h4 class="card-title"><a href="/activity/${o.id}">${o.name}</a></h4>
                                <ul class="list-inline product-meta">
                                    <li class="list-inline-item">
                                        <i class="fa fa-folder-open-o"></i>${o.category}
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>`;n.insertAdjacentHTML("beforeend",a)}),document.getElementById("loadMore").setAttribute("data-page",r),console.log("Updated page attribute to:",r),t.hasMore||(console.log("No more activities, hiding button"),document.getElementById("loadMore").style.display="none")}else console.log("No activities returned, hiding button"),document.getElementById("loadMore").style.display="none"}).catch(t=>{console.error("Error loading more activities:",t)})}document.addEventListener("DOMContentLoaded",function(){console.log("Initializing load more button"),document.getElementById("loadMore").setAttribute("data-page","0")});let currentRecommendedPage=0;function loadMoreRecommended(){currentRecommendedPage++,console.log(`Loading recommended activities page ${currentRecommendedPage}`),fetch(`/?page=${currentRecommendedPage}&recommendedOnly=true`).then(e=>e.text()).then(e=>{const t=new DOMParser().parseFromString(e,"text/html"),n=t.querySelectorAll("#recommendedActivitiesContainer > div");if(console.log(`Found ${n.length} new recommended activities`),n.length>0){const i=document.getElementById("recommendedActivitiesContainer");n.forEach(c=>{i.appendChild(c.cloneNode(!0))})}const o=document.getElementById("loadMoreRecommended");t.querySelector("#loadMoreRecommended")||(console.log("No more recommended activities to load"),o&&(o.style.display="none"))}).catch(e=>{console.error("Error loading more recommended activities:",e)})}async function loadMoreReview(){page++;const e=document.getElementById("loadMore"),r=document.getElementById("noMoreReviewsMessage");if(!e){console.error("\u274C Error: El bot\xF3n 'Cargar m\xE1s' no existe en el DOM.");return}const t=e.getAttribute("data-activity-id"),o=await(await fetch(`/moreReviews?activityId=${t}&page=${page}`)).text(),a=document.getElementById("allReviewsPaginated");if(!a){console.error("\u274C Error: El contenedor de rese\xF1as no existe en el DOM.");return}a.insertAdjacentHTML("beforeend",o);const i=document.createElement("div");i.innerHTML=o,i.querySelector("#loadMoreIndicator")?.getAttribute("data-has-more")==="true"||(e&&(e.style.display="none"),r&&(r.style.display="block"))}async function loadMoreUser(){page++;try{const e=await fetch(`/moreUsers?page=${page}`);if(!e.ok)throw new Error(`Error ${e.status}: No se pudo cargar m\xE1s usuarios.`);const r=await e.text();document.querySelector("#allUsersPaginated tbody").insertAdjacentHTML("beforeend",r);const t=document.createElement("div");t.innerHTML=r;const n=t.querySelector("#loadMoreIndicator");n&&n.getAttribute("data-has-more")==="true"||(document.getElementById("loadMore").style.display="none",document.getElementById("noMoreUsersMessage").style.display="block")}catch(e){console.error("Error al cargar m\xE1s usuarios:",e)}}let currentAdminPage=0;function loadMoreActivityAdmin(){currentAdminPage++,console.log(`Loading admin activities page ${currentAdminPage}`),fetch(`/adminActivities?page=${currentAdminPage}`).then(e=>e.text()).then(e=>{const t=new DOMParser().parseFromString(e,"text/html"),n=t.querySelectorAll("#activitiesTable tbody .activity-item");if(console.log(`Found ${n.length} new activities`),n.length>0){const i=document.querySelector("#activitiesTable tbody");n.forEach(c=>{i.appendChild(c.cloneNode(!0))})}const o=t.getElementById("currentPage").value,a=t.getElementById("totalPages").value;document.getElementById("currentPage").value=o,document.getElementById("totalPages").value=a,currentAdminPage>=a-1&&(document.getElementById("loadMore").style.display="none")}).catch(e=>{console.error("Error loading more activities:",e)})}async function loadMoreActivitiesSubscribed(){page++;try{const e=await fetch(`/moreActivitiesSubscribed?page=${page}`);if(!e.ok)throw new Error(`Error ${e.status}: No se pudo cargar m\xE1s actividades.`);const r=await e.text();document.querySelector("#allActivitiesPaginatedSubscribed tbody").insertAdjacentHTML("beforeend",r);const t=document.createElement("div");t.innerHTML=r;const n=t.querySelector("#loadMoreIndicator");n&&n.getAttribute("data-has-more")==="true"||(document.getElementById("loadMore").style.display="none",document.getElementById("noMoreSubscribedActivitysMessage").style.display="block")}catch(e){console.error("Error al cargar m\xE1s actividades:",e)}}
